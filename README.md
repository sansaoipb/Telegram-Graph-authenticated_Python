# Doações

<table>
		<tr>
			<td> <!-- PagSeguro -->
				<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
				<h3><a id="user-content-features" class="anchor" href="#features" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" role="img" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path></svg></a><div align="center">PagSeguro</div></h3>
				<a href="https://pag.ae/bljJm47"><img src="https://stc.pagseguro.uol.com.br/public/img/botoes/doacoes/120x53-doar.gif"></a>
            </td>
			<td> <!-- PayPal -->
				<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
				<h3><a id="user-content-features" class="anchor" href="#features" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" role="img" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path></svg></a><div align="center">PayPal</div></h3>
				<a href="https://www.paypal.com/cgi-bin/webscr?cmd=_donations&business=7VVS675TLJHUL&lc=BR&item_name=Eracydes%20Lima%20Carvalho%20Junior&currency_code=BRL&bn=PP%2dDonationsBF%3abtn_donateCC_LG%2egif%3aNonHosted"><img src="https://www.paypalobjects.com/pt_BR/BR/i/btn/btn_donateCC_LG.gif"></a>
			</td>
			<td> <!-- PicPay -->							
				<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
				<h3><a id="user-content-features" class="anchor" href="#features" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" role="img" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path></svg></a><div align="center">PicPay</div></h3>
				<a href="http://picpay.me/sansaoipb"><img src="https://lh3.googleusercontent.com/5HZ6-6yY-NT1uv0wC4cVZc6bDCXXBcfCnfFugaZhmqk4u5_sJrr7yO33i-9aPapdCEuVbKzJfBvDIzbcJg=w120-h53-rw"></a>
			</td>
		</tr>
</table>


<!--

<h3><a id="user-content-features" class="anchor" href="#features" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" role="img" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path></svg></a>PayPal:</h3>

[![paypal](https://www.paypalobjects.com/pt_BR/BR/i/btn/btn_donateCC_LG.gif)](https://www.paypal.com/cgi-bin/webscr?cmd=_donations&business=7VVS675TLJHUL&lc=BR&item_name=Eracydes%20Lima%20Carvalho%20Junior&currency_code=BRL&bn=PP%2dDonationsBF%3abtn_donateCC_LG%2egif%3aNonHosted) 


<h3><a id="user-content-features" class="anchor" href="#features" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" role="img" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path></svg></a>PagSeguro:</h3>

[![pagseguro](https://stc.pagseguro.uol.com.br/public/img/botoes/doacoes/120x53-doar.gif)](https://pag.ae/bljJm47)
-->

# Telegram-Graph-authenticated_Python
Em caso de dúvida, sugestão ou dificuldade junte-se a nós no <b>Grupo do Telegram</b> <a href="https://t.me/joinchat/B7Jjiz-ttMgvu3zJKarK2w" class="wikilink2" title="Ingressar no Grupo" rel="nofollow">Gráfico no Email e Telegram</a>.

Envio de alarmes no ZABBIX pelo Telegram com usuário autenticado com gráficos.<br>

O "How to" foi testado no ZABBIX 2.4 ao 5.0 no Debian 8-10/Ubuntu 14-20 e CentOS 6.x, 7 e 8, caso não utilize estas distros procure os pacotes descritos para sua necessidade.

<!--
# Acompanhe no Vídeo:
[![](https://img.youtube.com/vi/EBTh5cU_ZXM/0.jpg)](https://youtu.be/EBTh5cU_ZXM "Integração ZABBIX x Telegram com gráfico")
-->

# Sumário
<ul>
	<li>
		<strong>
			<a href=#requisitos>Requisitos</a>
		</strong>
	</li>
	<li>
		<strong>
			<a href=#edite-os-parâmetros>Parametros do script</a>
		</strong>
	</li>
	<li>
		<strong>
			<a href=#configurando-o-envio>Configuração do front</a>
		</strong>
	</li>
	<li>
		<strong>
			<a href=#conclusão>Conclusão</a>
		</strong>
	</li>
</ul>

<br>

# Requisitos:
<!--
<b>0 – </b> Estar logado com o user zabbix
<br>
<blockquote>Caso necessário, habilite como o comando abaixo e troque a senha:</blockquote>
<pre>sudo usermod -s /bin/bash zabbix ; sudo passwd zabbix</pre>
-->

<blockquote> <p>Instale os pacotes </p> </blockquote>
<blockquote> <p> Debian/Ubuntu</p> </blockquote>
<pre>$ sudo apt-get install -y wget dos2unix<br></pre>
<blockquote> <p>CentOS 6.x, 7 e 8</p> </blockquote>
<pre>sudo yum install -y epel-release ; sudo yum upgrade ; sudo yum install -y wget dos2unix</pre>

<blockquote> <p>Faça o download do script de instalação</p> </blockquote>
<pre>cd /tmp ; wget https://raw.githubusercontent.com/sansaoipb/scripts/master/telegram.sh -O telegram.sh ; dos2unix telegram.sh ; sh telegram.sh</pre>

<b>OBS:</b><br>
Existe um local padrão onde fica os scripts, que tem 2 locais possiveis dependendo da forma de instalação do ZABBIX, compilando (<code>/usr/local/share/zabbix/alertscripts/</code>) ou por pacote (<code>/usr/lib/zabbix/alertscripts/</code>), respectivamente.<br>
Os arquivos necessários para iniciarmos a configuração estarão na pasta <code>“alertscripts/telegram/”</code>, e o script <code>telegramGraph.py</code> na “raiz” onde o zabbix executará.
Ao final da execução do script, ele indicará qual pasta você acessará.

Para iniciarmos a configuração de envio, é preciso logar pela primeira vez manualmente, então entre no diretório <code>“que o script indicou”</code> e execute o <code>telegram-cli</code> com o comando abaixo.

<pre>sudo -u zabbix ./telegram-cli --rsa-key tg-server.pub --config telegram.config</pre>


<b>Após a execução, está mapeado alguns possiveis erros, e para corrigi-los siga os passos:</b>

<br>
<blockquote> <p>Para o CentOS 8</p> </blockquote>
<i>(homologado pelo amigo "Junior" <a href="https://t.me/amarodefarias" class="wikilink2" title="Conversar com ele" rel="nofollow">@amarodefarias</a>)</i>

<pre>
yum install -y readline-devel compat-openssl10
sudo ln -s /usr/lib64/libreadline.so.7 /usr/lib64/libreadline.so.6
sudo ln -s /usr/lib64/liblua-5.3.so /usr/lib64/liblua-5.1.so
sudo ln -s /usr/lib64/libssl.so.1.1.1 /usr/lib64/libssl.so.10
sudo ln -s /usr/lib64/libevent-2.1.so.6 /usr/lib64/libevent-2.0.so.5
</pre>

<br>
<blockquote> <p>Para o Ubuntu 19</p> </blockquote>
<i>(homologado pelo amigo "George Luiz" <a href="https://t.me/George_HPD" class="wikilink2" title="Conversar com ele" rel="nofollow">@George_HPD</a>)</i>

<pre>
sudo wget launchpadlibrarian.net/429633018/libmysqlclient20_5.7.26-1_amd64.deb
sudo dpkg -i libmysqlclient20_5.7.26-1_amd64.deb

sudo wget http://archive.ubuntu.com/ubuntu/pool/main/libe/libevent/libevent-2.0-5_2.0.21-stable-2ubuntu0.16.04.1_amd64.deb
sudo dpkg -i libevent-2.0-5_2.0.21-stable-2ubuntu0.16.04.1_amd64.deb
</pre>

<br>
<blockquote> <p>Para o Debian 10</p> </blockquote>
<i>(homologado pelo amigo "Bernardo Lankheet" <a href="https://t.me/bernardolankheet" class="wikilink2" title="Conversar com ele" rel="nofollow">@bernardolankheet</a>)</i>

<pre>
sudo ln -s /usr/lib/x86_64-linux-gnu/libevent_pthreads-2.1.so.6 /usr/lib/x86_64-linux-gnu/libevent_pthreads-2.0.so.5
sudo ln -s /usr/lib/x86_64-linux-gnu/libevent-2.1.so.6 /usr/lib/x86_64-linux-gnu/libevent-2.0.so.5
sudo ln -s /lib/x86_64-linux-gnu/libcrypto.so.1.1 /lib/x86_64-linux-gnu/libcrypto.so.1.0.0
</pre>

<br>
<blockquote> <p>Debian 9/Ubuntu 16</p> </blockquote>
<i>(Os dois primeiros homologados pelo amigo "Paulo Aguiar" <a href="https://t.me/aguiarpaulo" class="wikilink2" title="Conversar com ele" rel="nofollow">@aguiarpaulo</a>)</i>
<br>


<b>Para o erro:</b>
<br>
"./telegram-cli --rsa-key tg-server.pub --config telegram.config
./telegram-cli: /usr/lib/x86_64-linux-gnu/libcrypto.so.1.0.0: version `OPENSSL_1.0.0' not found (required by ./telegram-cli)"

<pre><b>Instale:</b>
No Debian 9 <a href="https://distros-repository.usharesoft.com/debian/jessie-backports/mirror/ftp.fr.debian.org/debian/pool/main/o/openssl/libssl1.0.0_1.0.2l-1~bpo8+1_amd64.deb" class="wikilink2" title="OpenSSL para Debian" rel="nofollow">este pacote</a>, no Ubuntu 16 <a href="https://distros-repository.usharesoft.com/ubuntu/xenial-security/mirror/bouyguestelecom.ubuntu.lafibre.info/ubuntu/pool/main/o/openssl/libssl1.0.0_1.0.2g-1ubuntu4.6_amd64.deb" class="wikilink2" title="OpenSSL para Ubuntu" rel="nofollow">este pacote</a></pre>
<br>

<!--
mirror
wget http://blog.alexolivan.com/downloads/libssl1.0.0_1.0.1t-1+deb8u3_amd64.deb
dpkg -i libssl1.0.0_1.0.1t-1+deb8u3_amd64.deb
-->


<b>Para o erro:</b>
<br>
"./telegram-cli: error while loading shared libraries: libpython3.4m.so.1.0: cannot open shared object file: No such file or directory"
<pre><b>Execute este comando:</b>
sudo ln -s /usr/lib/x86_64-linux-gnu/libpython3.5m.so.1.0 /usr/lib/x86_64-linux-gnu/libpython3.4m.so.1.0</pre>
<br>


<b>Para o erro:</b>
"./telegram-cli: error while loading shared libraries: libreadline.so.6: cannot open shared object file: No such file or directory"
<br>
<pre><b>Execute este comando:</b>
sudo ln -s /lib/x86_64-linux-gnu/libreadline.so.5 /lib/x86_64-linux-gnu/libreadline.so.6</pre>

<br><br>
Será redirecionado para o console da ferramenta, indicado por um “>”, aguarde até que o texto <code>phone number</code> apareça, depois digite o número de telefone que está cadastrado no telegram, no formato +552244448888 (prefixo para o Brasil, DDD e número), depois que der “Enter” e receberá um código por SMS e no aplicativo <i>(no desktop, no celular ou na versão web, basta estar logado)</i>.
O comando <code>help</code> lista todos os comandos disponíveis, os comandos <code>contact_list</code> e <code>dialog_list</code> carregam sua lista de contatos e as conversas atuais, todos os comandos tem autocomplete usando o TAB.

Para configurarmos o zabbix a enviar mensagens para usuários, grupos ou canais, é necessário executar os comandos <code>user_info</code>, <code>chat_info</code> ou <code>channel_info</code> seguido do nome do contato, do grupo ou do canal conforme está na sua agenda, pegue o “ID”, o “nome de cadastro” ou o "nome de registro" que aparecerá (os nomes também tem autocomplete).

<b>OBS:</b><br>
<b>1 – </b> Se o escolher utilizar o nome cadastrado, precisa atentar a alguns pontos: <br>
<b>1.1 – </b> Caso tenha sobrenome, é necessário ter underscore (_) entre eles; <br>
<b>1.2 – </b> O nome não pode conter acentos, no caso abaixo, se meu nome estivesse com “~” como “Sansão” não funcionaria e eu precisaria ter cadastrado sem ele (assim como fiz);

<b>Ex:</b><br>
<img src="https://lh3.googleusercontent.com/ZEivFtEiU-_ntgKIi-HYQo92nwSqHPj7VAckE_8TjrCCU_lqn4YX1VT29guJn-WREsOSo-s25TRTb5XoLZLNWtmi5CIHQRK-C8JuAYC81gRR8lsjSkep2pAQQ6wCyS8K9Fxh9aoshF7WapjfEq7lzfwlnRrZe2IV8UuhRDUYtSJrbgJiS3YLDQqVDPWNXyF9AEXCP82QDH7b81PuHXVoDR2PKy-X34ZJlYgKcegWE14moFete989JDdhu80Y7H7RVs6RakRwdscJqo3S8t5DWL_wVCPKXWzGUy9KiHXy870ueCDwsdprf7GfBJ-Mprg3wUSVzCSTk6-R3NCG1UcxwM9XBWqVI-RIvWFGclVp4ha0DeORa_31C8r9E-hLI41peXjnSZIRscrDjCZUrC8uh1nqJjFvPh980ZdiiYakt_DwA5EysmML7mcKKiLw1mqSZwbOKcamhDhyRH9367K3a9DSnMzyymwW-w7NCc0cZ6PDT7fUxcR5UBNorHelOSXDck7ugurlwbuaM7g6qs01gF9ZpuQ4QQrMXy4ACCr7Q6pRRSBfv4EympUGP0M3x3MaR_PmTVvh_R10syvn0fH-elzw1Z5aws9uRbd_6FpSm-rp_F2T=w411-h69-no"/><br><br>

Para enviar a mensagem, é preciso usar o ID ou o nome, conforme as estruturas abaixo:<br>
<code>user#129131403</code><br>
<code>Sansao_Simonton</code><br>
<code>@sansaoipb</code><br>

Agora o telegram-cli está configurado para utilizar a sua conta. Podemos sair do console dele digitando <code>safe_quit</code> <i>(se já tiver aberto em outro momento)</i> ou <code>quit</code><i>(caso seja a primeira vez que estiver logando)</i>


<h3><a id="user-content-features" class="anchor" href="#features" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" role="img" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path></svg></a> OBS IMPORTANTE:</h3>

<b>1 – </b> O daemon <code><i>“telegram-cli”</i></code> é de SO x64, logo não irá funcionar em SO x86.<br>
<!--
<b>2 – </b> Por limitação da aplicação <code><i>“telegram-cli”</i></code>, ainda não é possível enviar mensagem para <b>SUPERGRUPOS</b>, pois não houve atualização depois desta novidade
-->

# Edite os parâmetros:

Entre no arquivo <code>configScrips.properties</code> e edite os campos abaixo:

<ul class="task-list">
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="checked" disabled="disabled"><font><font class=""> “url” = 'http://127.0.0.1/zabbix' - URL de acesso ao FRONT com "http://" </font></font></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="checked" disabled="disabled"><font><font class=""> “user”   = 'Admin';</font></font></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="checked" disabled="disabled"><font><font class=""> “pass”     = 'zabbix';</font></font></li></ul>

<b>OBS:</b><br>
<b>1 – </b>O usuário que você declarar no campo <i>“user”</i> precisa ter permissão no mínimo de leitura no ambiente.<br>

<h3><a id="user-content-features" class="anchor" href="#features" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" role="img" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path></svg></a>Comando para teste</h3>

Script para realização do teste:<br>
<b>Script, user#ID, Nome ou user.</b><br>
Exs:<br>
<pre>sudo -u zabbix ./telegramgraph-teste.py user#123456789</pre>
ou
<pre>sudo -u zabbix ./telegramgraph-teste.py Nome_Sobrenome</pre>
ou
<pre>sudo -u zabbix ./telegramgraph-teste.py @usuario</pre>

<b>OBS:</b><br>
<b>1 – </b>"user#123456789", "Nome_Sobrenome" ou @usuario são informações fictícias para exemplificar, busque um UserID ou nome de usuário válido em seu ambiente com os comandos já passados para realização do teste;<br>
<b>2 – </b>Se optar por usar o ID, como "user#123456789", “user#” é para quando for usuário, quando for grupo será “chat#”, quando for canal será “channel#” seguido do respectivo ID<br>

# Configurando o envio:

Com o script adicionado no local indicado acima, precisamos realizar algumas configurações no Front do ZABBIX, no <i>"Tipo de Mídia"</i>, (em Administração  > Tipo de Mídia) e a <i>"Ação"</i> (em Configuração  > Ações).

<h3><a id="user-content-features" class="anchor" href="#features" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" role="img" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path></svg></a>Tipo de Mídia</h3>

<blockquote> <p>Zabbix 2.4</p> </blockquote>
<img src="https://lh3.googleusercontent.com/FYnv-B4eOnSWPC3GkQLsqak610MnYqXDUBlZQE1qmSHkCXvTfddyNwPcMtnkaFBhU3zSstclZSj8b4WNag=w425-h107-rw"/><br><br>
<blockquote> <p>Zabbix 3.0 à 4.4</p> </blockquote>
<img src="https://lh3.googleusercontent.com/E1rSALiZb0E3UC9iHvqVqMrcB5EaRnBnHAYJdfjYEjV4qqkHhnkaWa7q3BsNPkhF7QoqXlk84rtIYY2wUw=w399-h220-rw"/><br><br>

<b>OBS:</b><br>
Na versão 3.0, é obrigatório a utilização das macros <code>{ALERT.SENDTO}</code>, <code>{ALERT.SUBJECT}</code> e <code>{ALERT.MESSAGE}</code>, em caso de dúvidas, leia a Documentação 
<a href="https://www.zabbix.com/documentation/3.0/manual/config/notifications/media/script" class="wikilink2" title="Documentação Oficial" rel="nofollow">Aqui</a>.<br><br>

<h3><a id="user-content-features" class="anchor" href="#features" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" role="img" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path></svg></a>Configurando o usuário</h3>

<img src="https://lh3.googleusercontent.com/HP0_HH3oP9Zea0m91nQqOhanZbAiafBFq1UCY1ZZfR9fH-gi4ov3TbY91pzsZJhO2jvzRuEdyEauN3GBxHJCGd65UkdaPGiGXEjZtVgMUab0KXt5TtIBcZ2DaCnehQfIN8CPjABBrBljBJFui1DeX-9BXgesrsZZcvfJaIJph1o4hSPrSoI87vHctyFEJqsZ5z7VvAKPHZwU1oXMMC4Ef0ddfyWrr_bPD1Zj5ixZIwZbIqX0HJdMcVAj1vrhJGT0UfcriT1yDwiE_0TCYlqifIFw2WZIuMH2qU5VFearWiTy1yVIXO40On_cnRxR3xfh_wKbLG0F9lKy7XQv1MHZZ0okeTTNjeYY0YWPXN9CE_seZEJqjxBFIr92gQPWtKVG2leV9XltOEKrWz5ByFTxqNzrlWMAj3DtOwAO7ZIMIciL48P8XkeR5qzGJX1e5ydkDQ4EhHoR86-EYGhJJbcnyopSvDuQOUQiHfkr4zAP1yWJjWxfYsyOF9_lCPeQvgOc9LMijFvfmWD-9yO4o7Wk4YEbdPl74cfRxsn5RfiKCZF8Qpj4hOo6ixlqcSbmbuMRrCxlCHbomOS9ac5kGcog6vZF6Gjl_b0I1CV4g5MkY2xLJU_GbF78BfBAVuYU5Bx4Qx5Gg5Tpy9TkP5_qpZZAsZtbmqhXCBnM4CJnIIOOUOnxPpiOj3NplQ=w426-h254-no"/><br>

<h3><a id="user-content-features" class="anchor" href="#features" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" role="img" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path></svg></a>Criando a Ação:</h3>

A “<i>Mensagem Padrão</i>” na aba <b>“<u>Ação</u>”</b> existe somente com uma “exigência”, a primeira linha deve permanecer com as macros/variáveis abaixo ilustradas (<i>as macros/variáveis <b>entre as "#" </b></i>), podendo editar da segunda linha em diante. 
<br>
<h3><a id="user-content-features" class="anchor" href="#features" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" role="img" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path></svg></a>Imagem da Mensagem na Ação:</h3>

<img src="https://lh3.googleusercontent.com/RuDq_CboE2tNdieWYN84JvRfhFIms4umWOzHDOM5hgANwWX-OvyVcuqeDUrZLhq3nlrTY-GQFPSpFg"/><br><br>

<blockquote> Modelo Mensagem Padrão</blockquote>
<pre>{ITEM.NAME}#{EVENT.ID}#{ITEM.ID}#00C800#3600#\n<br>IP/DNS: {HOST.CONN}\n<br>Último valor = {ITEM.LASTVALUE}\n</pre>

<b>OBS:</b><br>
<i><b>”00C800”</b></i> é a cor da linha (verde) em Hex. sem tralha, e <i><b>”3600”</b></i> é o período do gráfico (1h) em segundo.
<h3><a id="user-content-features" class="anchor" href="#features" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" role="img" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path></svg></a>Resultado da linha de teste:</h3>

<img src="https://lh3.googleusercontent.com/dJ0S7n1JmibxVp0ulJinRjCZdn0bC9lJWg2VO21HKC3WDM81TZwsZS4b8KRNql0TUuUncDYG7xd6kFDo5zTCdaa9zvANxDZJxmC2MSLkKmbF7QBB1fbCUzVwk7wiCvZ4RYpXahRvz_XQ0MEvr0wUPViF357mhb8u4Nmnj-BP46Wyo5GKANSbfLLk7dtwiZiAauy99nq2xIfBgadaVVZ7JTzNVTdj1AE1oeGw7eZQ_8yzprvD2fVzgGBbWBtfBu2yqgmzkyfy_COQp9NjQ82eCpQBcaEhtoEqGoY9R_hjOHNPnQWYhaRpBgQNr5zLLZGZ2TojJdzaP8IZvtVNaWonhc85VpIIFLGtt162iPEeuxylPjIqfS89fAx5lwlsxBcGxG61-g1mQcxsGsMUjdTobfnaIRJW_MO4p30LaVonMlhNCdVVC5Feio8f7TtVD2gAl9L25PuQb4Qq8MwD7GWkYw6MjSQy7ZJdb9u9VZXvrG4E6lhIUaVPGDhuZGDqBQsHAi9CUWTmwTruBjKfa6azeuGD2A2bJ0TkbPjDCGb7AyCJ5avSYVkKWXbgOgI1JuExSyr2zQ9YuoRVcuEQi--QmmRieplrLnd0z4Azh3qbDX2n7hzsQ1bxNlxg8uSevq_6uFV19bU6pxkU47sjXWBUILQcjty3gxatUd81CRvuqnsD9Ikb5C56Ew=w687-h308-no"/>
<br>
<br>

# Conclusão

1 – Este script é para agilizar a análise e ficar visualmente mais agradável o recebimento dos alarmes.<br><br>
2 – O script realiza uma consulta API mais ampla, detecta automaticamente se o item é de caracter/log/texto, e não envia o gráfico "sem dados" somente o texto, ele dá "ack" no evento e informa quem foi notificado naquela ação, armazena log. <br><br>
3 – Nos nomes de contatos, grupos e canais, espaços são transformados em underscore (_), tralha/jogo da velha (#), arrobas (@) e contatos com mesmo nome tem um <i>“#1”</i>  acrescentado ao nome (exemplo: Gnu#1, Gnu#2).
<br><br><br><br>


<!--
<h3><a id="user-content-features" class="anchor" href="#features" aria-hidden="true"><svg aria-hidden="true" class="octicon octicon-link" height="16" role="img" version="1.1" viewBox="0 0 16 16" width="16"><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path></svg></a>Doações:</h3>

<blockquote> <p>PayPal / PagSeguro</p> </blockquote>

[![paypal](https://www.paypalobjects.com/pt_BR/BR/i/btn/btn_donateCC_LG.gif)](https://www.paypal.com/cgi-bin/webscr?cmd=_donations&business=SANSAOIPB%40GMAIL%2eCOM&lc=BR&item_name=Sansao%20Projets&no_note=0&currency_code=BRL&bn=PP%2dDonationsBF%3abtn_donateCC_LG%2egif%3aNonHostedGuest) [![pagseguro](https://stc.pagseguro.uol.com.br/public/img/botoes/doacoes/120x53-doar.gif)](https://pag.ae/bljJm47)

<blockquote> <p>PayPal</p> </blockquote>

[![paypal](https://www.paypalobjects.com/pt_BR/BR/i/btn/btn_donateCC_LG.gif)](https://www.paypal.com/cgi-bin/webscr?cmd=_donations&business=SANSAOIPB%40GMAIL%2eCOM&lc=BR&item_name=Sansao%20Projets&no_note=0&currency_code=BRL&bn=PP%2dDonationsBF%3abtn_donateCC_LG%2egif%3aNonHostedGuest)

<blockquote> <p>PagSeguro</p> </blockquote>

[![pagseguro](https://stc.pagseguro.uol.com.br/public/img/botoes/doacoes/120x53-doar.gif)](https://pag.ae/bljJm47)
-->
